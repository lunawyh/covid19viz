// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/LayerList/templates/LayerList.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n  \x3cdiv role\x3d"menu" data-dojo-attach-point\x3d"_container" class\x3d"${css.container}"\x3e\r\n    \x3cul role\x3d"group" class\x3d"${css.list}" data-dojo-attach-point\x3d"_layersNode"\x3e\x3c/ul\x3e\r\n    \x3cdiv class\x3d"${css.noLayersText}" data-dojo-attach-point\x3d"_noLayersNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/LayerList","dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel ../kernel dojo/uacss dojo/Deferred dojo/on dojo/query dojo/dom-class dojo/dom-style dojo/dom-construct dojo/dom-attr dojo/i18n!../nls/jsapi dijit/a11yclick dijit/_WidgetBase dijit/_TemplatedMixin ../promiseList ../layerUtils dojo/text!./LayerList/templates/LayerList.html".split(" "),function(p,v,m,L,M,N,C,r,F,l,D,k,n,x,E,O,P,Q,R,S){function J(a){var b=a.layer,c=a.nodes;a=a.className;var b=b.getMap()?
b.visibleAtMapScale:!0,d=c.checkbox,c=c.layer;l.toggle(c,a,!b);b?(n.remove(c,"aria-disabled"),n.remove(d,"disabled")):(n.set(c,"aria-disabled","true"),n.set(d,"disabled","disabled"))}var T=p.some(["ar","he"],function(a){return-1!==L.locale.indexOf(a)});v=v([O,P],{templateString:S,defaults:{theme:"esriLayerList",map:null,layers:null,showSubLayers:!0,showOpacitySlider:!1,showLegend:!1,removeUnderscores:!0,visible:!0},constructor:function(a){a=m.mixin({},this.defaults,a);this.set(a);this.css={container:"esriContainer",
noLayers:"esriNoLayers",noLayersText:"esriNoLayersText",slider:"esriSlider",sliderLabels:"esriSliderLabels",legend:"esriLegend",tabContainer:"esriTabContainer",tabs:"esriTabs",tabMenu:"esriTabMenu",tabMenuItem:"esriTabMenuItem",tabMenuSelected:"esriTabMenuSelected",tabMenuVisible:"esriTabMenuVisible",tab:"esriTab",tabSelected:"esriTabSelected",toggleButton:"esriToggleButton",iconCollapse:"esri-icon-down",iconExpand:T?"esri-icon-left":"esri-icon-right",list:"esriList",listExpand:"esriListExpand",subListExpand:"esriSubListExpand",
listVisible:"esriListVisible",subList:"esriSubList",hasSubList:"esriHasSubList",hasButton:"esriHasButton",hasTabContent:"esriHasTabContent",subListLayer:"esriSubListLayer",layer:"esriLayer",layerScaleInvisible:"esriScaleInvisible",title:"esriTitle",titleContainer:"esriTitleContainer",checkbox:"esriCheckbox",label:"esriLabel",button:"esriButton",content:"esriContent",clearFix:"esriClearFix",clear:"esriClear"}},postCreate:function(){this.inherited(arguments);var a=this;this.own(r(this._layersNode,r.selector("."+
this.css.checkbox,"change"),function(){var b,c;b=n.get(this,"data-layer-index");c=n.get(this,"data-sublayer-index");a._toggleLayer(b,c);a._toggleState(b,c)}));this.own(r(this._layersNode,r.selector("."+this.css.tabMenuItem,E.press),function(){var b=n.get(this,"data-layer-index"),c=n.get(this,"data-tab-id");a._toggleTab(b,c)}));this.own(r(this._layersNode,r.selector("."+this.css.toggleButton,E.press),function(){var b=n.get(this,"data-layer-index");a._toggleExpand(b)}))},startup:function(){this.inherited(arguments);
this._mapLoaded(this.map).then(m.hitch(this,this._init))},destroy:function(){this._removeEvents();this.inherited(arguments)},refresh:function(){var a=this.layers;this._nodes=[];var b=[];if(a&&a.length)for(var c=0;c<a.length;c++)b.push(this._layerLoaded(c));return Q(b).always(m.hitch(this,function(a){this._loadedLayers=a;this._removeEvents();this._createLayerNodes();this._setLayerEvents();this.emit("refresh")}))},_mapLoaded:function(a){var b=new C;if(a)if(a.loaded)b.resolve();else r.once(a,"load",
m.hitch(this,function(){b.resolve()}));else b.resolve();return b.promise},_toggleExpand:function(a){a=parseInt(a,10);if(a=this._nodes[a]){var b=a.layer;l.toggle(b,this.css.listExpand);b=l.contains(b,this.css.listExpand);n.set(a.toggle,"title",b?x.widgets.layerList.collapse:x.widgets.layerList.expand);l.toggle(a.toggle,this.css.iconCollapse,b);l.toggle(a.toggle,this.css.iconExpand,!b)}},_toggleTab:function(a,b){a=parseInt(a,10);if(a=this._nodes[a]){var c=a.tabMenu;a=F("[data-tab-id]",a.tabs);var c=
F("[data-tab-id]",c),d;for(d=0;d<a.length;d++){var e=n.get(a[d],"data-tab-id");l.toggle(a[d],this.css.tabSelected,b===e)}for(d=0;d<c.length;d++)a=n.get(c[d],"data-tab-id"),l.toggle(c[d],this.css.tabMenuSelected,b===a)}},_layerLoaded:function(a){var b=this.layers[a],c=b.layer,d={layer:c,layerInfo:b,layerIndex:a},e=new C;if(c)if(c.loaded)e.resolve(d);else if(c.loadError)e.reject(c.loadError);else{var f,g;f=r.once(c,"load",m.hitch(this,function(){g.remove();e.resolve(d)}));g=r.once(c,"error",m.hitch(this,
function(a){f.remove();e.reject(a)}))}else e.resolve(d);return e.promise},_checkboxStatus:function(a){return!!a.visibility},_WMSVisible:function(a,b){var c=[];a&&a.layer&&(c=a.layer.visibleLayers);return-1<p.indexOf(c,b.name)},_subCheckboxStatus:function(a,b){switch(a.layer.declaredClass){case "esri.layers.KMLLayer":a=b.visible;break;case "esri.layers.WMSLayer":a=this._WMSVisible(a,b);break;default:a=b.defaultVisibility}return!!a},_getLayerTitle:function(a){var b="",c=a.layer;(a=a.layerInfo)&&a.title?
b=a.title:c&&c.arcgisProps&&c.arcgisProps.title?b=c.arcgisProps.title:c&&c.name?b=c.name:a&&a.id?b=a.id:c&&c.id&&(b=c.id);return this.removeUnderscores?b.replace(/_/g," "):b},_showSublayers:function(a){return a.hasOwnProperty("showSubLayers")?a.showSubLayers:this.showSubLayers},_opacityChange:function(a){if(this.layer)this.layer.setOpacity(a);else if(this.layers)for(var b=0;b<this.layers.length;b++)this.layers[b].layerObject&&this.layers[b].layerObject.setOpacity(a)},_legend:function(a,b,c){var d=
k.create("div",{role:"tabpanel","data-tab-id":"legend",className:this.css.tab+" "+this.css.legend},a);require(["esri/dijit/Legend"],m.hitch(this,function(a){var e=[b];if(b&&b.featureCollection&&b.featureCollection.layers)for(var e=b.featureCollection.layers,g=0;g<e.length;g++)e[g].layer=e[g].layerObject;a=new a({map:this.map,layerInfos:e},k.create("div"));k.place(a.domNode,d);a.startup();this._nodes[c].legend=a}))},_slider:function(a,b,c,d){a=k.create("div",{role:"tabpanel","data-tab-id":"opacity",
className:this.css.tab+" "+this.css.slider},a);var e=k.create("div",{},a),f=k.create("div",{},a);require(["dijit/form/HorizontalSlider","dijit/form/HorizontalRuleLabels"],m.hitch(this,function(a,h){a=new a({showButtons:!1,minimum:.1,maximum:1,layer:b,layers:c,discreteValues:.1,intermediateChanges:!0,value:d,onChange:this._opacityChange},e);h=new h({container:"bottomDecoration",count:0,className:this.css.sliderLabels,labels:["0","50","100"]},f);a.startup();h.startup()}))},_createLayerNodes:function(){this._layersNode.innerHTML=
"";this._noLayersNode.innerHTML="";l.remove(this._container,this.css.noLayers);var a=this._loadedLayers;if(a&&a.length)for(var b=0;b<a.length;b++){var c=a[b];if(c){var d=c.layer,e=c.layerIndex,f=c.layerInfo;if(f){if(f.featureCollection&&!f.hasOwnProperty("visibility")){var g=f.featureCollection.layers[0];g&&g.layerObject&&(f.visibility=g.layerObject.visible)}d&&!f.hasOwnProperty("visibility")&&(f.visibility=f.layer.visible);d&&!f.hasOwnProperty("id")&&(f.id=f.layer.id);var h,g=k.create("li",{role:"menuitem",
className:this.css.layer});k.place(g,this._layersNode,"first");h=k.create("div",{className:this.css.title},g);var m=k.create("div",{className:this.css.tabContainer},g),p=k.create("ul",{role:"tablist",className:this.css.tabMenu+" "+this.css.clearFix},m),m=k.create("div",{className:this.css.tabs},m),r=[],y;d&&(y=d.declaredClass);var t=this._checkboxStatus(f),u=k.create("div",{className:this.css.titleContainer},h),q=this.id+"_checkbox_"+e,z=k.create("input",{type:"checkbox",id:q,"data-layer-index":e,
className:this.css.checkbox},u);n.set(z,"checked",t);var w=k.create("div",{tabindex:0,role:"button","data-layer-index":e,title:x.widgets.layerList.expand,className:this.css.toggleButton+" "+this.css.iconExpand},u),v;f.button&&(v=f.button,l.add(g,this.css.hasButton),l.add(v,this.css.button),k.place(v,u));c=this._getLayerTitle(c);c=k.create("label",{className:this.css.label,textContent:c},u);n.set(c,"for",q);var q=k.create("div",{className:this.css.clear},u),G;f.content&&(G=f.content,l.add(G,this.css.content),
k.place(G,h));h={checkbox:z,title:h,tabMenu:p,tabs:m,titleContainer:u,label:c,layer:g,toggle:w,clear:q,button:v,content:G,subNodes:r};this._nodes[e]=h;l.toggle(g,this.css.listVisible,t);if(d&&(J({layer:d,className:this.css.layerScaleInvisible,nodes:h}),h=d.layerInfos,"esri.layers.KMLLayer"===y&&(h=d.folders),u=this._showSublayers(f),"esri.layers.ArcGISTiledMapServiceLayer"!==y&&h&&h.length))if(u){k.create("li",{tabindex:0,"data-tab-id":"sublayers","data-layer-index":e,role:"tab",className:this.css.tabMenuItem,
textContent:x.widgets.layerList.sublayers},p);l.add(g,this.css.hasSubList);l.toggle(g,this.css.subListExpand,t);for(var t=k.create("div",{className:this.css.tab,"data-tab-id":"sublayers",role:"tabpanel"},m),u=k.create("ul",{role:"group",className:this.css.subList},t),C,z=[],t=0;t<h.length;t++){var c=h[t],A,q=-1,w=null;"esri.layers.ArcGISDynamicMapServiceLayer"===y?(A=c.id,q=c.parentLayerId,c.subLayerIds||(c.defaultVisibility=d&&d.visibleLayers&&-1!==d.visibleLayers.indexOf(c.id)?!0:!1)):"esri.layers.KMLLayer"===
y?(A=c.id,q=c.parentFolderId):"esri.layers.WMSLayer"===y&&(A=c.name,q=-1);if(-1!==q)if(w=this._nodes[e].subNodes[q],z[q])w=z[q];else{var B=w.subLayer,w=k.create("ul",{role:"group",className:this.css.subList},B);l.add(B,this.css.hasSubList);l.toggle(B,[this.css.listVisible,this.css.subListExpand],K);z[q]=w}var K=this._subCheckboxStatus(f,c);K&&!C&&(C=!0);var H=this.id+"_checkbox_sub_"+e+"_"+A,q=k.create("li",{role:"menuitem",className:this.css.subListLayer},w||u),B=k.create("div",{className:this.css.title},
q),I=k.create("div",{className:this.css.titleContainer},B),D=k.create("input",{type:"checkbox",id:H,"data-layer-index":e,"data-sublayer-index":A,className:this.css.checkbox},I);n.set(D,"checked",K);c=k.create("label",{className:this.css.label,textContent:c.title||c.name||""},I);n.set(c,"for",H);H=k.create("div",{className:this.css.clear},I);r[A]={subList:u,subSubList:w,subLayer:q,subTitle:B,subTitleContainer:I,subCheckbox:D,subLabel:c,subClear:H}}}else for(t=0;t<h.length;t++)c=h[t],q=-1,"esri.layers.ArcGISDynamicMapServiceLayer"===
y&&(q=c.parentLayerId,c.subLayerIds||(c.defaultVisibility=d&&d.visibleLayers&&-1!==d.visibleLayers.indexOf(c.id)?!0:!1));if(f.hasOwnProperty("showLegend")?f.showLegend:this.showLegend)k.create("li",{tabindex:0,role:"tab",className:this.css.tabMenuItem,"data-layer-index":e,"data-tab-id":"legend",textContent:x.widgets.layerList.legend},p),this._legend(m,f,e);if(f.hasOwnProperty("showOpacitySlider")?f.showOpacitySlider:this.showOpacitySlider){var E;!d&&f.featureCollection?(E=f.featureCollection.layers,
f=f.featureCollection.layers[0].opacity):f=d.opacity;k.create("li",{tabindex:0,"data-tab-id":"opacity",role:"tab",className:this.css.tabMenuItem,"data-layer-index":e,textContent:x.widgets.layerList.opacity},p);this._slider(m,d,E,f)}d=F("."+this.css.tab,m);if(e=d.length)l.add(g,[this.css.hasTabContent]),l.add(d[0],this.css.tabSelected);1<e&&(l.add(g,this.css.tabMenuVisible),g=F("li",p),g.length&&l.add(g[0],this.css.tabMenuSelected))}}}else l.add(this._container,this.css.noLayers),n.set(this._noLayersNode,
"textContent",x.widgets.layerList.noLayers)},_removeEvents:function(){if(this._layerEvents&&this._layerEvents.length)for(var a=0;a<this._layerEvents.length;a++)this._layerEvents[a].remove();this._layerEvents=[]},_emitToggle:function(a,b,c){this.emit("toggle",{layerIndex:a,subLayerIndex:b,visible:c})},_toggleVisible:function(a,b){var c=this._nodes[a].checkbox;l.toggle(this._nodes[a].layer,this.css.listVisible,b);var d=n.get(c,"checked");l.contains(this._nodes[a].layer,this.css.hasSubList)&&l.toggle(this._nodes[a].layer,
this.css.subListExpand,d);d!==b&&(n.set(c,"checked",b),this._emitToggle(a,null,b))},_layerVisChangeEvent:function(a,b,c){var d;d=b?a.layerInfo.featureCollection.layers[c].layer:a.layer;c=r(d,"visibility-change",m.hitch(this,function(c){var d=this.layers&&this.layers[a.layerIndex];d&&(d.visibility=c.visible);b?this._featureCollectionVisible(a.layerIndex,c.visible):this._toggleVisible(a.layerIndex,c.visible)}));this._layerEvents.push(c);if(!b){var e=this._nodes[a.layerIndex],f=this.css.layerScaleInvisible;
J({nodes:e,className:f,layer:d});c=r(d,"scale-visibility-change",m.hitch(this,function(a){J({nodes:e,className:f,layer:d})}));this._layerEvents.push(c);"esri.layers.ArcGISDynamicMapServiceLayer"===d.declaredClass&&(c=r(this.map,"zoom-end",m.hitch(this,function(){this._subLayerScale(a)})),this._layerEvents.push(c),this._subLayerScale(a))}},_subLayerScale:function(a){var b=a.layer.createDynamicLayerInfosFromLayerInfos(),c=R._getLayersForScale(this.map.getScale(),b);p.forEach(b,m.hitch(this,function(b){if(!b.subLayerIds){b=
b.id;var d=this._nodes[a.layerIndex].subNodes[b];if(d){var f=d.subLayer,d=d.subCheckbox,g=!1;-1===p.indexOf(c,b)&&(g=!0);l.toggle(f,this.css.layerScaleInvisible,g);g?(n.set(f,"aria-disabled","true"),n.set(d,"disabled","disabled")):(n.remove(f,"aria-disabled"),n.remove(d,"disabled"))}}}))},_layerEvent:function(a){var b=a.layerInfo;if(b.featureCollection&&b.featureCollection.layers&&b.featureCollection.layers.length){if((b=b.featureCollection.layers)&&b.length)for(var c=0;c<b.length;c++)this._layerVisChangeEvent(a,
!0,c)}else this._layerVisChangeEvent(a)},_getVisibleLayers:function(a,b){var c=a.layerInfos,d=[-1];"undefined"!==typeof b&&(b=this._getLayerInfo(a,b),b.defaultVisibility=!b.defaultVisibility);for(b=0;b<c.length;b++){var e=c[b];e.defaultVisibility&&(d.push(e.id),e=p.lastIndexOf(d,-1),-1!==e&&d.splice(e,1))}c=[];for(b=0;b<d.length;b++)e=d[b],this._allIdsPresent(a,e,d)&&c.push(e);d=[];for(b=0;b<c.length;b++)(e=this._getLayerInfo(a,c[b]))&&null===e.subLayerIds&&d.push(c[b]);d.length||(d=[-1]);return d},
_toggleState:function(a,b){a=parseInt(a,10);var c=this._nodes[a];c.legend&&c.legend.refresh();null!==b?(b=parseInt(b,10),a=c.subNodes[b].subLayer,b=c.subNodes[b].subCheckbox):(a=c.layer,b=c.checkbox);b=n.get(b,"checked");l.contains(a,this.css.hasSubList)&&l.toggle(a,this.css.subListExpand,b);l.toggle(a,this.css.listVisible,b)},_toggleLayer:function(a,b){if(this.layers&&this.layers.length){var c;a=parseInt(a,10);var d=this.layers[a],e=d.layer,f=e&&e.layerInfos,g;e&&(g=e.declaredClass);var h=d.featureCollection;
if(h)for(c=!d.visibility,d.visibility=c,d=0;d<h.layers.length;d++)h.layers[d].layerObject.setVisibility(c);else if(e)if(null!==b){if("esri.layers.ArcGISDynamicMapServiceLayer"===g)b=parseInt(b,10),h=this._getVisibleLayers(e,b),e.setVisibleLayers(h);else if("esri.layers.KMLLayer"===g)for(b=parseInt(b,10),h=e.folders,d=0;d<h.length;d++){if(g=h[d],g.id===b){e.setFolderVisibility(g,!g.visible);break}}else"esri.layers.WMSLayer"===g&&(h=e.visibleLayers,d=p.indexOf(h,b),-1===d?h.push(b):h.splice(d,1),e.setVisibleLayers(h));
f&&(c=this._getLayerInfo(e,b).defaultVisibility)}else"esri.layers.ArcGISDynamicMapServiceLayer"===g&&(h=this._getVisibleLayers(e),e.setVisibleLayers(h)),c=!e.visible,d.visibility=c,e.setVisibility(c);else c=!d.visible,d.setVisibility(c);this._emitToggle(a,b,c)}},_featureCollectionVisible:function(a,b){var c=this.layers[a],d=c.visibleLayers,e=c.featureCollection.layers;(d&&d.length?p.every(d,function(a){return e[a].layer.visible===b}):p.every(e,function(a){return a.layer.visible===b}))&&this._toggleVisible(a,
b)},_setLayerEvents:function(){var a=this._loadedLayers;a&&a.length&&p.forEach(a,function(a,c){var b=a.layer;b&&(b.getMap()?this._layerEvent(a):(c=r(this.map,"layer-add-result",m.hitch(this,function(c){c.layer===b&&this._layerEvent(a)})),this._layerEvents.push(c)))},this)},_allIdsPresent:function(a,b,c){a=this._walkUpLayerIds(a,b);return p.every(a,function(a){return-1<p.indexOf(c,a)})},_walkUpLayerIds:function(a,b){var c=this._getLayerInfo(a,b);b=[];if(c)for(;-1!==c.parentLayerId;)(c=this._getLayerInfo(a,
c.parentLayerId))&&b.push(c.id);return b},_getLayerInfo:function(a,b){for(var c,d=0;d<a.layerInfos.length;d++){var e=a.layerInfos[d];if(e.id===b){c=e;break}}return c},_isSupportedLayerType:function(a){return a&&!a._basemapGalleryLayerType||a&&"basemap"!==a._basemapGalleryLayerType},_createLayerInfo:function(a){return{layer:a}},_updateAllMapLayers:function(){if(this.map&&(!this.layers||!this.layers.length)){var a=[];p.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&
a.push(this._createLayerInfo(b))},this);p.forEach(this.map.graphicsLayerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&b._params&&b._params.drawMode&&a.push(this._createLayerInfo(b))},this);this._set("layers",a)}},_init:function(){this._visible();this._updateAllMapLayers();this.refresh().always(m.hitch(this,function(){this.set("loaded",!0);this.emit("load")}))},_visible:function(){this.visible?D.set(this.domNode,"display","block"):D.set(this.domNode,"display","none")},_setThemeAttr:function(a){this.domNode&&
(l.remove(this.domNode,this.theme),l.add(this.domNode,a));this._set("theme",a)},_setMapAttr:function(a){this._set("map",a);this._created&&this._mapLoaded(this.map).then(m.hitch(this,function(){this._updateAllMapLayers();this.refresh()}))},_setLayersAttr:function(a){this._set("layers",a);this._created&&this.refresh()},_setRemoveUnderscoresAttr:function(a){this._set("removeUnderscores",a);this._created&&this.refresh()},_setShowSubLayersAttr:function(a){this._set("showSubLayers",a);this._created&&this.refresh()},
_setShowOpacitySliderAttr:function(a){this._set("showOpacitySlider",a);this._created&&this.refresh()},_setShowLegendAttr:function(a){this._set("showLegend",a);this._created&&this.refresh()},_setVisibleAttr:function(a){this._set("visible",a);this._created&&this._visible()}});N("extend-esri")&&m.setObject("dijit.LayerList",v,M);return v});